<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruleta Gastronómica Pro - Decide Qué Comer con IA</title>
    <meta name="description" content="La mejor ruleta gastronómica con IA. Decide qué comer con recomendaciones inteligentes, más de 500 opciones culinarias y sistema de preferencias personalizadas.">
    <meta name="keywords" content="ruleta comida, qué comer, recomendaciones IA, gastronomía, menú aleatorio, decisiones culinarias">
    <meta name="author" content="Ruleta Gastronómica Pro">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://ruletacomida.pro">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Ruleta Gastronómica Pro - Decide Qué Comer">
    <meta property="og:description" content="Ruleta inteligente con IA para decidir qué comer. Recomendaciones personalizadas y más de 500 opciones culinarias.">
    <meta property="og:image" content="https://ruletacomida.pro/og-image.jpg">
    <meta property="og:url" content="https://ruletacomida.pro">
    <meta property="og:type" content="website">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Ruleta Gastronómica Pro">
    <meta name="twitter:description" content="Decide qué comer con nuestra ruleta inteligente con IA">
    
    <!-- Schema.org -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Ruleta Gastronómica Pro",
        "description": "Aplicación web avanzada para decidir qué comer con IA y recomendaciones personalizadas",
        "url": "https://ruletacomida.pro",
        "applicationCategory": "Food & Dining",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "featureList": [
            "Ruleta interactiva",
            "Recomendaciones con IA",
            "Más de 500 opciones culinarias",
            "Sistema de preferencias"
        ]
    }
    </script>
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://pagead2.googlesyndication.com">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            /* Color System */
            --primary-50: #FEF2F2;
            --primary-100: #FEE2E2;
            --primary-200: #FECACA;
            --primary-300: #FCA5A5;
            --primary-400: #F87171;
            --primary-500: #EF4444;
            --primary-600: #DC2626;
            --primary-700: #B91C1C;
            --primary-800: #991B1B;
            --primary-900: #7F1D1D;
            
            --secondary-50: #FFFBEB;
            --secondary-100: #FEF3C7;
            --secondary-200: #FDE68A;
            --secondary-300: #FCD34D;
            --secondary-400: #FBBF24;
            --secondary-500: #F59E0B;
            --secondary-600: #D97706;
            --secondary-700: #B45309;
            --secondary-800: #92400E;
            --secondary-900: #78350F;
            
            --accent-50: #ECFDF5;
            --accent-100: #D1FAE5;
            --accent-200: #A7F3D0;
            --accent-300: #6EE7B7;
            --accent-400: #34D399;
            --accent-500: #10B981;
            --accent-600: #059669;
            --accent-700: #047857;
            --accent-800: #065F46;
            --accent-900: #064E3B;
            
            /* Grays */
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-400: #9CA3AF;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-800: #1F2937;
            --gray-900: #111827;
            
            /* Semantic Colors */
            --success: var(--accent-500);
            --warning: var(--secondary-500);
            --error: var(--primary-500);
            --info: #3B82F6;
            
            /* Typography */
            --font-primary: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            --font-display: 'Poppins', var(--font-primary);
            
            /* Spacing */
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --space-10: 2.5rem;
            --space-12: 3rem;
            --space-16: 4rem;
            --space-20: 5rem;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            
            /* Gradients */
            --gradient-primary: linear-gradient(135deg, var(--primary-500), var(--primary-700));
            --gradient-secondary: linear-gradient(135deg, var(--secondary-400), var(--secondary-600));
            --gradient-accent: linear-gradient(135deg, var(--accent-400), var(--accent-600));
            --gradient-hero: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-food: linear-gradient(135deg, #f093fb 0%, #f5576c 50%, #4facfe 100%);
            
            /* Border Radius */
            --radius-sm: 0.125rem;
            --radius: 0.25rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
            --radius-xl: 0.75rem;
            --radius-2xl: 1rem;
            --radius-3xl: 1.5rem;
            --radius-full: 9999px;
            
            /* Transitions */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 300ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 500ms cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* CSS Reset & Base Styles */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        html {
            scroll-behavior: smooth;
            font-size: 16px;
        }
        
        body {
            font-family: var(--font-primary);
            line-height: 1.6;
            color: var(--gray-900);
            background: var(--gradient-hero);
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Utility Classes */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        .container {
            width: 100%;
            max-width: 1440px;
            margin: 0 auto;
            padding: 0 var(--space-4);
        }
        
        /* Ad Styles */
        .ad-container {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            text-align: center;
            border-radius: var(--radius-lg);
            background: var(--gradient-secondary);
            color: white;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }
        
        .ad-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .ad-top {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: min(728px, calc(100vw - 2rem));
            height: 90px;
            z-index: 1000;
            border-radius: 0 0 var(--radius-xl) var(--radius-xl);
        }
        
        .ad-sidebar {
            position: fixed;
            right: var(--space-4);
            top: 50%;
            transform: translateY(-50%);
            width: 300px;
            height: 600px;
            z-index: 100;
            display: none;
        }
        
        .ad-content {
            width: min(336px, 100%);
            height: 280px;
            margin: var(--space-16) auto;
        }
        
        @media (min-width: 1440px) {
            .ad-sidebar { display: flex; }
            .main-content { margin-right: 320px; }
        }
        
        @media (max-width: 768px) {
            .ad-top {
                width: calc(100vw - 2rem);
                height: 60px;
                font-size: 0.875rem;
            }
        }
        
        /* Header */
        .header {
            text-align: center;
            padding: var(--space-20) 0 var(--space-16);
            margin-top: 110px;
        }
        
        .header h1 {
            font-family: var(--font-display);
            font-size: clamp(2.5rem, 6vw, 4.5rem);
            font-weight: 800;
            background: linear-gradient(135deg, white, #f0f9ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: var(--space-6);
            text-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .header p {
            font-size: clamp(1.125rem, 3vw, 1.5rem);
            color: rgba(255, 255, 255, 0.9);
            max-width: 600px;
            margin: 0 auto;
            font-weight: 400;
        }
        
        /* Main Card */
        .main-card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-3xl);
            box-shadow: var(--shadow-2xl);
            margin: var(--space-8) auto;
            max-width: 1200px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card-header {
            background: var(--gradient-food);
            padding: var(--space-12) var(--space-8);
            text-align: center;
            color: white;
        }
        
        .card-header h2 {
            font-family: var(--font-display);
            font-size: clamp(1.875rem, 4vw, 2.5rem);
            font-weight: 700;
            margin-bottom: var(--space-4);
        }
        
        .card-content {
            padding: var(--space-12) var(--space-8);
        }
        
        /* Roulette Styles */
        .roulette-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-8);
            margin-bottom: var(--space-12);
        }
        
        .roulette-wrapper {
            position: relative;
            width: 400px;
            height: 400px;
            max-width: 90vw;
            max-height: 90vw;
        }
        
        .roulette-wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            transition: transform 4s cubic-bezier(0.25, 0.1, 0.25, 1);
            box-shadow: var(--shadow-2xl);
            border: 8px solid white;
            background: #fff;
            will-change: transform;
        }
        
        .roulette-slice {
            position: absolute;
            width: 50%;
            height: 50%;
            top: 50%;
            left: 50%;
            transform-origin: 0 0;
            overflow: hidden;
            border-left: 2px solid rgba(255,255,255,0.3);
        }
        
        .slice-content {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            color: white;
            font-weight: 700;
            font-size: 14px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            transform: rotate(45deg);
            transform-origin: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .roulette-pointer {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 30px solid var(--gray-800);
            z-index: 10;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
        }
        
        .roulette-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            z-index: 10;
            box-shadow: var(--shadow-xl);
            border: 4px solid white;
        }
        
        /* Controls */
        .controls-section {
            background: var(--gray-50);
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            margin-bottom: var(--space-8);
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-6);
        }
        
        .input-group {
            display: flex;
            gap: var(--space-3);
        }
        
        .input-field {
            flex: 1;
            padding: var(--space-4) var(--space-5);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-xl);
            font-size: 1rem;
            font-weight: 500;
            outline: none;
            transition: all var(--transition-normal);
            background: white;
        }
        
        .input-field:focus {
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }
        
        .input-field:invalid {
            border-color: var(--error);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            padding: var(--space-4) var(--space-6);
            border: none;
            border-radius: var(--radius-xl);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-normal);
            text-decoration: none;
            white-space: nowrap;
            position: relative;
            overflow: hidden;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-lg);
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: var(--gray-100);
            color: var(--gray-700);
            border: 2px solid var(--gray-200);
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: var(--gray-200);
            border-color: var(--gray-300);
        }
        
        .btn-accent {
            background: var(--gradient-accent);
            color: white;
            box-shadow: var(--shadow-lg);
        }
        
        .btn-accent:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }
        
        .spin-btn {
            background: var(--gradient-food);
            color: white;
            padding: var(--space-6) var(--space-12);
            font-size: 1.25rem;
            font-weight: 700;
            border-radius: var(--radius-full);
            box-shadow: var(--shadow-xl);
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }
        
        .spin-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        
        .spin-btn:disabled {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .spin-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.6s ease;
        }
        
        .spin-btn:active::before {
            width: 300px;
            height: 300px;
        }
        
        /* Options Display */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: var(--space-4);
            margin-top: var(--space-6);
        }
        
        .option-card {
            background: var(--gradient-secondary);
            padding: var(--space-4) var(--space-5);
            border-radius: var(--radius-xl);
            color: var(--gray-800);
            font-weight: 600;
            text-align: center;
            position: relative;
            box-shadow: var(--shadow-md);
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 60px;
            cursor: grab;
            user-select: none;
        }
        
        .option-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .option-card .remove-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 24px;
            height: 24px;
            background: var(--error);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 0.75rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-md);
            transition: all var(--transition-fast);
        }
        
        .remove-btn:hover {
            background: var(--primary-700);
            transform: scale(1.1);
        }
        
        /* Result Display */
        .result-container {
            text-align: center;
            margin: var(--space-8) 0;
            opacity: 0;
            transform: translateY(20px);
            transition: all var(--transition-slow);
        }
        
        .result-container.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .result-card {
            background: var(--gradient-accent);
            border-radius: var(--radius-3xl);
            padding: var(--space-12) var(--space-8);
            color: white;
            box-shadow: var(--shadow-2xl);
            position: relative;
            overflow: hidden;
        }
        
        .result-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: rotate 3s linear infinite;
        }
        
        @keyframes rotate {
            to { transform: rotate(360deg); }
        }
        
        .result-text {
            font-family: var(--font-display);
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 800;
            margin-bottom: var(--space-4);
            position: relative;
            z-index: 1;
        }
        
        .result-description {
            font-size: 1.25rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        .result-actions {
            display: flex;
            gap: var(--space-4);
            justify-content: center;
            margin-top: var(--space-8);
            flex-wrap: wrap;
        }
        
        /* Recommendations */
        .recommendations-section {
            background: var(--gray-50);
            border-radius: var(--radius-3xl);
            padding: var(--space-12) var(--space-8);
            margin-top: var(--space-12);
        }
        
        .recommendations-header {
            text-align: center;
            margin-bottom: var(--space-10);
        }
        
        .recommendations-header h2 {
            font-family: var(--font-display);
            font-size: clamp(1.875rem, 4vw, 2.5rem);
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-4);
        }
        
        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: var(--space-6);
        }
        
        .recommendation-card {
            background: white;
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            box-shadow: var(--shadow-lg);
            transition: all var(--transition-normal);
            border: 1px solid var(--gray-100);
        }
        
        .recommendation-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-2xl);
            border-color: var(--primary-200);
        }
        
        .recommendation-card h3 {
            font-family: var(--font-display);
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: var(--space-3);
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }
        
        .recommendation-card p {
            color: var(--gray-600);
            line-height: 1.6;
            margin-bottom: var(--space-4);
        }
        
        .recommendation-card .stats {
            display: flex;
            gap: var(--space-4);
            margin-bottom: var(--space-4);
        }
        
        .stat {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: 0.875rem;
            color: var(--gray-500);
        }
        
        .recommendation-card .action-btn {
            width: 100%;
            margin-top: var(--space-4);
        }
        
        /* Loading States */
        .loading-container {
            display: none;
            text-align: center;
            padding: var(--space-8);
        }
        
        .loading-container.show {
            display: block;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--gray-200);
            border-top: 4px solid var(--primary-500);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto var(--space-4);
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: var(--gray-600);
            font-weight: 500;
        }
        
        /* Statistics Panel */
        .stats-panel {
            background: linear-gradient(135deg, var(--gray-800), var(--gray-900));
            color: white;
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            margin-top: var(--space-8);
            box-shadow: var(--shadow-xl);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--space-6);
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--secondary-400);
            display: block;
        }
        
        .stat-label {
            font-size: 0.875rem;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Cookie Notice */
        .cookie-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--gray-900);
            color: white;
            padding: var(--space-6);
            z-index: 1000;
            transform: translateY(100%);
            transition: transform var(--transition-normal);
            border-top: 4px solid var(--primary-500);
        }
        
        .cookie-banner.show {
            transform: translateY(0);
        }
        
        .cookie-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-6);
            flex-wrap: wrap;
        }
        
        .cookie-text {
            flex: 1;
            min-width: 300px;
        }
        
        .cookie-actions {
            display: flex;
            gap: var(--space-3);
        }
        
        /* Dark Mode */
        .dark-mode {
            --gray-50: #111827;
            --gray-100: #1F2937;
            --gray-200: #374151;
            --gray-900: #F9FAFB;
        }
        
        .dark-mode .main-card {
            background: rgba(31, 41, 55, 0.95);
            color: white;
        }
        
        .dark-mode .controls-section,
        .dark-mode .recommendations-section {
            background: var(--gray-800);
        }
        
        .dark-mode .recommendation-card {
            background: var(--gray-700);
            color: white;
            border-color: var(--gray-600);
        }
        
        .dark-mode .input-field {
            background: var(--gray-700);
            border-color: var(--gray-600);
            color: white;
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .roulette-wrapper {
                width: 350px;
                height: 350px;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 0 var(--space-3);
            }
            
            .header {
                padding: var(--space-16) 0 var(--space-12);
                margin-top: 80px;
            }
            
            .card-content {
                padding: var(--space-8) var(--space-4);
            }
            
            .controls-grid {
                grid-template-columns: 1fr;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            .roulette-wrapper {
                width: 300px;
                height: 300px;
            }
            
            .options-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .result-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .cookie-content {
                flex-direction: column;
                text-align: center;
            }
        }
        
        @media (max-width: 480px) {
            .roulette-wrapper {
                width: 250px;
                height: 250px;
            }
            
            .spin-btn {
                padding: var(--space-4) var(--space-8);
                font-size: 1rem;
            }
            
            .options-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Winner Celebration Popup */
        .winner-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s ease;
        }
        
        .winner-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        .winner-popup {
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4, #45b7d1, #feca57);
            background-size: 400% 400%;
            animation: rainbow-bg 3s ease infinite;
            border-radius: 30px;
            padding: 60px 40px;
            text-align: center;
            max-width: 90vw;
            max-height: 90vh;
            position: relative;
            overflow: hidden;
            box-shadow: 0 30px 60px rgba(0,0,0,0.3);
            transform: scale(0.3) rotate(15deg);
            transition: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            will-change: transform, opacity;
        }
        
        .winner-overlay.show .winner-popup {
            transform: scale(1) rotate(0deg);
        }
        
        @keyframes rainbow-bg {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .winner-popup::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: rotate-shine 2s linear infinite;
            pointer-events: none;
        }
        
        @keyframes rotate-shine {
            to { transform: rotate(360deg); }
        }
        
        .winner-emoji {
            font-size: clamp(4rem, 15vw, 8rem);
            display: block;
            margin-bottom: 20px;
            animation: bounce-party 1s ease infinite;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.3));
        }
        
        @keyframes bounce-party {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0) scale(1); }
            40% { transform: translateY(-30px) scale(1.1); }
            60% { transform: translateY(-15px) scale(1.05); }
        }
        
        .winner-title {
            font-family: var(--font-display);
            font-size: clamp(2rem, 8vw, 4rem);
            font-weight: 800;
            color: white;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            margin-bottom: 10px;
            animation: text-glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes text-glow {
            from { text-shadow: 3px 3px 6px rgba(0,0,0,0.5), 0 0 20px rgba(255,255,255,0.5); }
            to { text-shadow: 3px 3px 6px rgba(0,0,0,0.5), 0 0 40px rgba(255,255,255,0.8), 0 0 60px rgba(255,255,255,0.6); }
        }
        
        .winner-food {
            font-family: var(--font-display);
            font-size: clamp(2.5rem, 10vw, 5rem);
            font-weight: 900;
            background: linear-gradient(45deg, #fff, #f0f9ff, #fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 20px 0;
            text-transform: uppercase;
            letter-spacing: 3px;
            animation: food-pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes food-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .winner-message {
            font-size: clamp(1.2rem, 4vw, 1.8rem);
            color: white;
            margin: 20px 0 40px;
            font-weight: 600;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: fade-in-up 1s ease 0.5s both;
        }
        
        @keyframes fade-in-up {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .winner-actions {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            animation: fade-in-up 1s ease 1s both;
        }
        
        .celebration-btn {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .celebration-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            background: rgba(255, 255, 255, 0.3);
        }
        
        .celebration-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.6s ease;
        }
        
        .celebration-btn:active::before {
            width: 300px;
            height: 300px;
        }
        
        /* Confetti Canvas */
        .confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }
        
        /* Fireworks Canvas */
        .fireworks-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9998;
        }
        
        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        .focus-visible {
            outline: 2px solid var(--primary-500);
            outline-offset: 2px;
        }
        
        /* High contrast mode */
        @media (prefers-contrast: high) {
            :root {
                --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.8);
                --shadow: 0 4px 8px rgba(0, 0, 0, 0.8);
                --shadow-md: 0 8px 16px rgba(0, 0, 0, 0.8);
            }
        }
        
        /* Achievements */
        .achievements-container {
            background: var(--gray-50);
            border-radius: var(--radius-3xl);
            padding: var(--space-12) var(--space-8);
            margin-top: var(--space-12);
        }
        
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: var(--space-6);
        }
        
        .achievement-card {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            box-shadow: var(--shadow-md);
            text-align: center;
            transition: all var(--transition-normal);
            border: 1px solid var(--gray-100);
            opacity: 0.6;
        }
        
        .achievement-card.unlocked {
            opacity: 1;
            transform: scale(1.05);
            box-shadow: var(--shadow-xl);
            border-color: var(--accent-400);
        }
        
        .achievement-card .icon {
            font-size: 2.5rem;
            margin-bottom: var(--space-4);
            color: var(--gray-500);
        }
        
        .achievement-card.unlocked .icon {
            color: var(--accent-600);
        }
        
        .achievement-card h3 {
            font-size: 1.1rem;
            margin-bottom: var(--space-2);
        }
        
        .achievement-card p {
            font-size: 0.85rem;
            color: var(--gray-500);
        }
        
        /* Recipe Preview */
        .recipe-preview {
            background: white;
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            box-shadow: var(--shadow-lg);
            margin-top: var(--space-8);
            display: none;
        }
        
        .recipe-preview.show {
            display: block;
            animation: scaleIn 0.5s ease forwards;
        }
        
        .recipe-header {
            display: flex;
            align-items: center;
            gap: var(--space-6);
            margin-bottom: var(--space-6);
        }
        
        .recipe-image {
            width: 150px;
            height: 150px;
            border-radius: var(--radius-xl);
            background-color: var(--gray-100);
            background-size: cover;
            background-position: center;
        }
        
        .recipe-info {
            flex: 1;
        }
        
        .recipe-title {
            font-family: var(--font-display);
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: var(--space-2);
        }
        
        .recipe-meta {
            display: flex;
            gap: var(--space-6);
            margin-bottom: var(--space-4);
        }
        
        .recipe-stats {
            display: flex;
            gap: var(--space-4);
            margin-bottom: var(--space-6);
        }
        
        .recipe-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-8);
        }
        
        @media (max-width: 768px) {
            .recipe-content {
                grid-template-columns: 1fr;
            }
        }
        
        /* Dragging styles */
        .option-card.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }
        
        .option-card.drag-over {
            background: var(--accent-100);
            border: 2px dashed var(--accent-500);
        }
    </style>
</head>
<body>
    <!-- Canvas for effects -->
    <canvas class="confetti-canvas" id="confettiCanvas"></canvas>
    <canvas class="fireworks-canvas" id="fireworksCanvas"></canvas>
    
    <!-- Ad Banner Top -->
    <div class="ad-container ad-top" role="banner" aria-label="Advertisement">
        <i class="fas fa-utensils"></i>
        <span>Espacio Publicitario Premium - 728x90</span>
        <i class="fas fa-star"></i>
    </div>
    
    <!-- Ad Sidebar -->
    <div class="ad-container ad-sidebar" role="banner" aria-label="Sidebar Advertisement">
        <div>
            <i class="fas fa-mobile-alt" style="font-size: 2rem; margin-bottom: 1rem;"></i>
            <div>Publicidad Lateral</div>
            <div style="font-size: 0.875rem; opacity: 0.8;">300x600</div>
        </div>
    </div>
    
    <div class="main-content">
        <div class="container">
            <!-- Header Section -->
            <header class="header">
                <h1>
                    <span class="food-emoji">🎲</span>
                    Ruleta Gastronómica Pro
                    <span class="food-emoji">🍽️</span>
                </h1>
                <p>
                    La decisión perfecta para tu próxima comida. 
                    IA integrada, más de 500 opciones culinarias y recomendaciones personalizadas.
                </p>
            </header>
            
            <!-- Main Application Card -->
            <main class="main-card animate-scale-in">
                <div class="card-header">
                    <h2>
                        <i class="fas fa-dice"></i>
                        Tu Ruleta Personal
                    </h2>
                    <p>Añade hasta 8 opciones y deja que el destino decida</p>
                </div>
                
                <div class="card-content">
                    <!-- Roulette Section -->
                    <section class="roulette-container" role="main" aria-label="Ruleta de comidas">
                        <div class="roulette-wrapper">
                            <div class="roulette-pointer" aria-hidden="true"></div>
                            <div class="roulette-wheel" id="rouletteWheel" role="img" aria-label="Ruleta giratoria con opciones de comida">
                                <!-- Slices will be generated dynamically -->
                            </div>
                            <div class="roulette-center" aria-hidden="true">
                                <i class="fas fa-bullseye"></i>
                            </div>
                        </div>
                        
                        <button 
                            class="btn spin-btn" 
                            id="spinButton"
                            aria-describedby="spin-description"
                            type="button"
                        >
                            <i class="fas fa-sync-alt"></i>
                            ¡Girar Ruleta!
                        </button>
                        <div id="spin-description" class="sr-only">
                            Haz clic para girar la ruleta y seleccionar una opción de comida aleatoria
                        </div>
                    </section>
                    
                    <!-- Controls Section -->
                    <section class="controls-section">
                        <h3 style="margin-bottom: var(--space-6); font-size: 1.5rem; font-weight: 600;">
                            <i class="fas fa-cogs"></i>
                            Personaliza tus Opciones
                        </h3>
                        
                        <div class="controls-grid">
                            <div class="input-group">
                                <input 
                                    type="text" 
                                    class="input-field" 
                                    id="foodInput"
                                    placeholder="Escribe una comida..."
                                    maxlength="20"
                                    aria-label="Nueva opción de comida"
                                >
                                <button class="btn btn-primary" id="addButton" type="button">
                                    <i class="fas fa-plus"></i>
                                    Añadir
                                </button>
                            </div>
                            
                            <div class="input-group">
                                <button class="btn btn-secondary" id="clearButton" type="button">
                                    <i class="fas fa-trash"></i>
                                    Limpiar Todo
                                </button>
                                <button class="btn btn-accent" id="randomButton" type="button">
                                    <i class="fas fa-random"></i>
                                    Llenar Aleatorio
                                </button>
                            </div>
                        </div>
                        
                        <!-- Current Options Display -->
                        <div class="options-grid" id="optionsGrid" role="list" aria-label="Opciones actuales de la ruleta">
                            <!-- Options will be displayed here -->
                        </div>
                    </section>
                    
                    <!-- Ad Content -->
                    <div class="ad-container ad-content" role="banner" aria-label="Advertisement">
                        <div style="text-align: center;">
                            <i class="fas fa-ad" style="font-size: 2rem; margin-bottom: 0.5rem;"></i>
                            <div>Publicidad Premium</div>
                            <div style="font-size: 0.875rem; opacity: 0.8;">336x280</div>
                        </div>
                    </div>
                    
                    <!-- Result Section -->
                    <section class="result-container" id="resultContainer" role="alert" aria-live="polite">
                        <div class="result-card">
                            <div class="result-text" id="resultText">
                                ¡Tu elección es...!
                            </div>
                            <div class="result-description" id="resultDescription">
                                Prepárate para una experiencia gastronómica increíble
                            </div>
                            <div class="result-actions">
                                <button class="btn btn-primary" id="shareButton" type="button">
                                    <i class="fas fa-share-alt"></i>
                                    Compartir
                                </button>
                                <button class="btn btn-secondary" id="spinAgainButton" type="button">
                                    <i class="fas fa-redo"></i>
                                    Girar Otra Vez
                                </button>
                                <button class="btn btn-accent" id="getRecipeButton" type="button">
                                    <i class="fas fa-book-open"></i>
                                    Ver Receta
                                </button>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Recipe Preview -->
                    <section class="recipe-preview" id="recipePreview">
                        <div class="recipe-header">
                            <div class="recipe-image" id="recipeImage"></div>
                            <div class="recipe-info">
                                <h2 class="recipe-title" id="recipeTitle"></h2>
                                <div class="recipe-meta">
                                    <div id="recipeCuisine"></div>
                                    <div id="recipeDifficulty"></div>
                                </div>
                                <div class="recipe-stats">
                                    <div class="stat">
                                        <i class="fas fa-clock"></i>
                                        <span id="recipeTime"></span>
                                    </div>
                                    <div class="stat">
                                        <i class="fas fa-users"></i>
                                        <span id="recipeServings"></span>
                                    </div>
                                    <div class="stat">
                                        <i class="fas fa-fire"></i>
                                        <span id="recipeCalories"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="recipe-content">
                            <div>
                                <h3>Ingredientes</h3>
                                <ul id="recipeIngredients"></ul>
                            </div>
                            <div>
                                <h3>Preparación</h3>
                                <ol id="recipeInstructions"></ol>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Statistics Panel -->
                    <section class="stats-panel">
                        <h3 style="text-align: center; margin-bottom: var(--space-6); font-size: 1.5rem;">
                            <i class="fas fa-chart-bar"></i>
                            Tus Estadísticas
                        </h3>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-value" id="totalSpins">0</span>
                                <span class="stat-label">Giros Totales</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="favoriteFoodStat">🍕</span>
                                <span class="stat-label">Favorito</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="userLevel">1</span>
                                <span class="stat-label">Nivel</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="streakCount">0</span>
                                <span class="stat-label">Racha</span>
                            </div>
                        </div>
                    </section>
                </div>
            </main>
            
            <!-- Recommendations Section -->
            <section class="recommendations-section animate-fade-in-up">
                <div class="recommendations-header">
                    <h2>
                        <i class="fas fa-brain"></i>
                        Recomendaciones Inteligentes
                    </h2>
                    <p style="color: var(--gray-600); font-size: 1.125rem;">
                        Sugerencias personalizadas basadas en IA y tendencias gastronómicas
                    </p>
                </div>
                
                <!-- Loading State -->
                <div class="loading-container" id="loadingContainer">
                    <div class="spinner"></div>
                    <div class="loading-text">Generando recomendaciones con IA...</div>
                </div>
                
                <!-- Recommendations Grid -->
                <div class="recommendations-grid" id="recommendationsGrid">
                    <!-- Recommendations will be loaded here -->
                </div>
            </section>
            
            <!-- Achievements Section -->
            <section class="achievements-container">
                <div class="recommendations-header">
                    <h2>
                        <i class="fas fa-trophy"></i>
                        Tus Logros Gastronómicos
                    </h2>
                    <p style="color: var(--gray-600); font-size: 1.125rem;">
                        Desbloquea logros por usar la ruleta
                    </p>
                </div>
                
                <div class="achievements-grid" id="achievementsGrid">
                    <div class="achievement-card" data-id="first-spin">
                        <div class="icon"><i class="fas fa-star"></i></div>
                        <h3>Primer Giro</h3>
                        <p>Realiza tu primer giro en la ruleta</p>
                    </div>
                    
                    <div class="achievement-card" data-id="five-spins">
                        <div class="icon"><i class="fas fa-utensils"></i></div>
                        <h3>Gastrónomo</h3>
                        <p>Realiza 5 giros en la ruleta</p>
                    </div>
                    
                    <div class="achievement-card" data-id="ten-foods">
                        <div class="icon"><i class="fas fa-plus-circle"></i></div>
                        <h3>Variedad Culinaria</h3>
                        <p>Añade 10 opciones diferentes</p>
                    </div>
                    
                    <div class="achievement-card" data-id="daily-streak">
                        <div class="icon"><i class="fas fa-calendar-alt"></i></div>
                        <h3>Racha Diaria</h3>
                        <p>Usa la ruleta 3 días seguidos</p>
                    </div>
                </div>
            </section>
        </div>
    </div>
    
    <!-- Cookie Banner -->
    <div class="cookie-banner" id="cookieBanner">
        <div class="cookie-content">
            <div class="cookie-text">
                <i class="fas fa-cookie-bite"></i>
                Utilizamos cookies para personalizar tu experiencia y mostrar publicidad relevante. 
                Al continuar navegando, aceptas nuestras políticas.
            </div>
            <div class="cookie-actions">
                <button class="btn btn-secondary" id="cookieReject" type="button">
                    Rechazar
                </button>
                <button class="btn btn-primary" id="cookieAccept" type="button">
                    Aceptar Todas
                </button>
            </div>
        </div>
    </div>
    
    <!-- Winner Celebration Popup -->
    <div class="winner-overlay" id="winnerOverlay">
        <div class="winner-popup">
            <div class="winner-emoji" id="winnerEmoji">🎉</div>
            <div class="winner-title">¡GANADOR!</div>
            <div class="winner-food" id="winnerFood">Pizza</div>
            <div class="winner-message" id="winnerMessage">
                ¡Es hora de disfrutar esta deliciosa comida! 🍽️✨
            </div>
            <div class="winner-actions">
                <button class="celebration-btn" id="closeWinnerBtn" type="button">
                    <i class="fas fa-check"></i>
                    ¡Perfecto!
                </button>
                <button class="celebration-btn" id="spinAgainBtn" type="button">
                    <i class="fas fa-redo"></i>
                    Girar Otra Vez
                </button>
            </div>
        </div>
    </div>
    
    <script>
        /**
         * Advanced Food Roulette Application
         * Professional-grade JavaScript with modern patterns
         */
        
        class FoodRouletteApp {
            constructor() {
                this.state = {
                    foods: this.loadFoods(),
                    isSpinning: false,
                    currentResult: null,
                    userStats: this.loadUserStats(),
                    preferences: this.loadPreferences(),
                    cookiesAccepted: localStorage.getItem('cookiesAccepted') === 'true',
                    achievements: this.loadAchievements()
                };
                
                this.config = {
                    maxFoods: 8,
                    minFoods: 2,
                    spinDuration: 4000,
                    particleCount: 50,
                    colors: [
                        '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FECA57',
                        '#FF9FF3', '#54A0FF', '#5F27CD', '#00D2D3', '#FF9F43'
                    ]
                };
                
                // Canvas context setup
                this.confettiCtx = document.getElementById('confettiCanvas').getContext('2d');
                this.fireworksCtx = document.getElementById('fireworksCanvas').getContext('2d');
                
                // Resize canvas to match window size
                this.resizeCanvas();
                window.addEventListener('resize', this.resizeCanvas.bind(this));
                
                this.foodDatabase = {
                    comfort: ['Pizza', 'Hamburguesa', 'Pasta', 'Tacos', 'Lasaña', 'Mac & Cheese'],
                    healthy: ['Ensalada', 'Sushi', 'Poke Bowl', 'Quinoa', 'Salmón', 'Vegetales'],
                    exotic: ['Pad Thai', 'Ramen', 'Curry', 'Pho', 'Kimchi', 'Ceviche'],
                    quick: ['Sandwich', 'Wrap', 'Cereal', 'Smoothie', 'Tostadas', 'Yogurt'],
                    fancy: ['Risotto', 'Paella', 'Filet Mignon', 'Lobster', 'Truffle Pasta', 'Caviar']
                };
                
                this.recommendations = {
                    'Pizza': {
                        emoji: '🍕',
                        description: 'Clásica italiana perfecta para compartir',
                        calories: '300-400',
                        time: '15-30 min',
                        difficulty: 'Fácil'
                    },
                    'Tacos': {
                        emoji: '🌮',
                        description: 'Explosión de sabores mexicanos auténticos',
                        calories: '200-300',
                        time: '10-20 min',
                        difficulty: 'Fácil'
                    },
                    'Sushi': {
                        emoji: '🍣',
                        description: 'Arte culinario japonés, fresco y elegante',
                        calories: '150-250',
                        time: '45-60 min',
                        difficulty: 'Difícil'
                    },
                    'Hamburguesa': {
                        emoji: '🍔',
                        description: 'Americana clásica, jugosa y satisfactoria',
                        calories: '400-600',
                        time: '20-30 min',
                        difficulty: 'Medio'
                    },
                    'Pasta': {
                        emoji: '🍝',
                        description: 'Versatilidad italiana que nunca falla',
                        calories: '250-400',
                        time: '15-25 min',
                        difficulty: 'Fácil'
                    }
                };
                
                this.recipeDatabase = {
                    'Pizza': {
                        title: 'Pizza Margarita Casera',
                        cuisine: 'Italiana',
                        difficulty: 'Media',
                        time: '1 hora',
                        servings: '4 personas',
                        calories: '800 por porción',
                        ingredients: [
                            '250g de harina de fuerza',
                            '150ml de agua tibia',
                            '1 cucharadita de sal',
                            '1 cucharadita de azúcar',
                            '7g de levadura seca',
                            '2 cucharadas de aceite de oliva',
                            '150g de salsa de tomate',
                            '200g de mozzarella fresca',
                            'Hojas de albahaca fresca',
                            'Aceite de oliva virgen extra'
                        ],
                        instructions: [
                            'Mezcla la harina, sal, azúcar y levadura en un bol grande.',
                            'Añade el agua tibia y el aceite de oliva, mezcla hasta obtener una masa homogénea.',
                            'Amasa durante 10 minutos hasta que quede elástica y suave.',
                            'Deja reposar la masa 1 hora en un lugar cálido hasta que doble su volumen.',
                            'Estira la masa sobre una superficie enharinada y colócala en una bandeja de horno.',
                            'Extiende la salsa de tomate y añade la mozzarella en rodajas.',
                            'Hornea a 220°C durante 15-20 minutos hasta que la base esté crujiente.',
                            'Decora con albahaca fresca y un chorrito de aceite de oliva antes de servir.'
                        ],
                        image: 'https://images.unsplash.com/photo-1513104890138-7c749659a591?q=80&w=1000'
                    },
                    // More recipes can be added here
                };
                
                this.init();
            }
            
            resizeCanvas() {
                this.confettiCtx.canvas.width = window.innerWidth;
                this.confettiCtx.canvas.height = window.innerHeight;
                
                this.fireworksCtx.canvas.width = window.innerWidth;
                this.fireworksCtx.canvas.height = window.innerHeight;
            }
            
            init() {
                this.bindEvents();
                this.setupRoulette();
                this.updateOptionsDisplay();
                this.updateStats();
                this.updateAchievements();
                this.showCookieBanner();
                this.loadInitialRecommendations();
                
                // Setup drag and drop for options
                this.setupDragAndDrop();
                
                // Analytics
                this.trackPageView();
            }
            
            bindEvents() {
                // Main controls
                const spinButton = document.getElementById('spinButton');
                const addButton = document.getElementById('addButton');
                const clearButton = document.getElementById('clearButton');
                const randomButton = document.getElementById('randomButton');
                const foodInput = document.getElementById('foodInput');
                const shareButton = document.getElementById('shareButton');
                const spinAgainButton = document.getElementById('spinAgainButton');
                const getRecipeButton = document.getElementById('getRecipeButton');
                
                // Winner popup buttons
                const closeWinnerBtn = document.getElementById('closeWinnerBtn');
                const spinAgainBtn = document.getElementById('spinAgainBtn');
                
                // Cookie handling
                const cookieAccept = document.getElementById('cookieAccept');
                const cookieReject = document.getElementById('cookieReject');
                
                // Check if elements exist before adding listeners
                if (spinButton) spinButton.addEventListener('click', () => this.spinRoulette());
                if (addButton) addButton.addEventListener('click', () => this.addFood());
                if (clearButton) clearButton.addEventListener('click', () => this.clearFoods());
                if (randomButton) randomButton.addEventListener('click', () => this.fillRandom());
                if (shareButton) shareButton.addEventListener('click', () => this.shareResult());
                if (spinAgainButton) spinAgainButton.addEventListener('click', () => this.spinAgain());
                if (getRecipeButton) getRecipeButton.addEventListener('click', () => this.showRecipe());
                
                // Winner popup events
                if (closeWinnerBtn) closeWinnerBtn.addEventListener('click', () => this.closeWinnerPopup());
                if (spinAgainBtn) spinAgainBtn.addEventListener('click', () => this.spinAgain());
                
                // Cookie handling
                if (cookieAccept) cookieAccept.addEventListener('click', () => this.acceptCookies());
                if (cookieReject) cookieReject.addEventListener('click', () => this.rejectCookies());
                
                // Click outside popup to close
                const winnerOverlay = document.getElementById('winnerOverlay');
                if (winnerOverlay) {
                    winnerOverlay.addEventListener('click', (e) => {
                        if (e.target === winnerOverlay) {
                            this.closeWinnerPopup();
                        }
                    });
                }
                
                // Keyboard accessibility
                document.addEventListener('keydown', this.handleKeyboardNavigation.bind(this));
                
                // Window events
                window.addEventListener('resize', this.handleResize.bind(this));
                window.addEventListener('beforeunload', () => this.saveUserStats());
            }
            
            setupRoulette() {
                const wheel = document.getElementById('rouletteWheel');
                wheel.innerHTML = '';
                
                if (this.state.foods.length === 0) return;
                
                const sliceAngle = 360 / this.state.foods.length;
                
                this.state.foods.forEach((food, index) => {
                    const slice = document.createElement('div');
                    slice.className = 'roulette-slice';
                    
                    // Set background color
                    slice.style.background = this.config.colors[index % this.config.colors.length];
                    
                    // Position and rotate the slice
                    const rotation = index * sliceAngle;
                    slice.style.transform = `rotate(${rotation}deg) skewY(${90 - sliceAngle}deg)`;
                    
                    // Create content container
                    const content = document.createElement('div');
                    content.className = 'slice-content';
                    content.textContent = food;
                    
                    // Adjust content rotation based on slice angle
                    const contentRotation = (sliceAngle / 2) - 90;
                    content.style.transform = `rotate(${contentRotation}deg)`;
                    
                    slice.appendChild(content);
                    wheel.appendChild(slice);
                });
                
                console.log(`Ruleta creada con ${this.state.foods.length} opciones:`, this.state.foods);
            }
            
            async spinRoulette() {
                if (this.state.isSpinning || this.state.foods.length < this.config.minFoods) {
                    this.showNotification('Añade al menos 2 opciones para girar', 'warning');
                    return;
                }
                
                this.state.isSpinning = true;
                this.updateSpinButton(true);
                this.hideResult();
                
                // Pre-select winner randomly
                const winnerIndex = Math.floor(Math.random() * this.state.foods.length);
                const winner = this.state.foods[winnerIndex];
                
                console.log('Ganador seleccionado:', winner, 'en posición:', winnerIndex);
                
                // Calculate rotation to land on winner
                const sliceAngle = 360 / this.state.foods.length;
                const targetAngle = winnerIndex * sliceAngle + (sliceAngle / 2); // Center of slice
                
                // Add multiple full rotations for effect
                const extraSpins = 5 + Math.random() * 3; // 5-8 full rotations
                const finalRotation = extraSpins * 360 + (360 - targetAngle); // 360 - because we want the slice to align with the top pointer
                
                console.log('Rotación final:', finalRotation, 'grados');
                
                // Start spinning animation
                const wheel = document.getElementById('rouletteWheel');
                wheel.classList.add('spinning');
                wheel.style.transform = `rotate(${finalRotation}deg)`;
                
                this.createSpinEffects();
                
                // Wait for animation to complete
                setTimeout(() => {
                    wheel.classList.remove('spinning');
                    this.state.currentResult = winner;
                    this.state.isSpinning = false;
                    this.updateSpinButton(false);
                    
                    // Show epic celebration after wheel stops
                    setTimeout(() => {
                        this.showResult(winner);
                        this.updateUserStats(winner);
                        this.generateRecommendations(winner);
                        this.checkAchievements();
                    }, 300);
                    
                    console.log('¡Resultado final:', winner, '!');
                    
                    // Analytics
                    this.trackEvent('spin_roulette', { food: winner, options_count: this.state.foods.length });
                }, this.config.spinDuration);
            }
            
            addFood() {
                const input = document.getElementById('foodInput');
                const newFood = input.value.trim();
                
                if (!newFood) {
                    this.showNotification('Por favor escribe una comida', 'warning');
                    return;
                }
                
                if (this.state.foods.length >= this.config.maxFoods) {
                    this.showNotification(`Máximo ${this.config.maxFoods} opciones permitidas`, 'warning');
                    return;
                }
                
                if (this.state.foods.some(food => food.toLowerCase() === newFood.toLowerCase())) {
                    this.showNotification('Esta opción ya existe', 'warning');
                    return;
                }
                
                this.state.foods.push(newFood);
                input.value = '';
                this.updateDisplay();
                this.showNotification(`"${newFood}" añadido`, 'success');
                this.trackEvent('add_food', { food: newFood });
                this.saveFoods();
            }
            
            removeFood(index) {
                if (this.state.foods.length <= this.config.minFoods) {
                    this.showNotification('Mantén al menos 2 opciones', 'warning');
                    return;
                }
                
                const removedFood = this.state.foods.splice(index, 1)[0];
                this.updateDisplay();
                this.showNotification(`"${removedFood}" eliminado`, 'info');
                this.saveFoods();
            }
            
            clearFoods() {
                this.state.foods = [];
                this.updateDisplay();
                this.hideResult();
                this.showNotification('Todas las opciones eliminadas', 'info');
                this.saveFoods();
            }
            
            fillRandom() {
                const categories = Object.keys(this.foodDatabase);
                const randomCategory = categories[Math.floor(Math.random() * categories.length)];
                const categoryFoods = this.foodDatabase[randomCategory];
                
                this.state.foods = this.shuffleArray(categoryFoods).slice(0, 6);
                this.updateDisplay();
                this.showNotification(`Llenado con comidas ${randomCategory}`, 'success');
                this.saveFoods();
            }
            
            updateDisplay() {
                this.setupRoulette();
                this.updateOptionsDisplay();
            }
            
            updateOptionsDisplay() {
                const grid = document.getElementById('optionsGrid');
                grid.innerHTML = '';
                
                this.state.foods.forEach((food, index) => {
                    const card = document.createElement('div');
                    card.className = 'option-card animate-scale-in';
                    card.role = 'listitem';
                    card.draggable = true;
                    card.dataset.index = index;
                    card.style.animationDelay = `${index * 0.1}s`;
                    
                    card.innerHTML = `
                        <span>${food}</span>
                        <button 
                            class="remove-btn" 
                            aria-label="Eliminar ${food}"
                            type="button"
                        >
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    
                    // Add event listener for the remove button
                    const removeBtn = card.querySelector('.remove-btn');
                    removeBtn.addEventListener('click', () => this.removeFood(index));
                    
                    grid.appendChild(card);
                });
            }
            
            showResult(winner) {
                const container = document.getElementById('resultContainer');
                const resultText = document.getElementById('resultText');
                const resultDesc = document.getElementById('resultDescription');
                
                resultText.textContent = winner;
                resultDesc.textContent = this.recommendations[winner]?.description || '¡Una elección perfecta!';
                
                container.classList.add('show');
                
                // Start epic celebration
                this.startEpicCelebration(winner);
            }
            
            startEpicCelebration(winner) {
                const recommendation = this.recommendations[winner];
                const emoji = recommendation?.emoji || '🍽️';
                
                // Update popup content
                document.getElementById('winnerEmoji').textContent = emoji;
                document.getElementById('winnerFood').textContent = winner.toUpperCase();
                document.getElementById('winnerMessage').textContent = 
                    recommendation?.description || '¡Una elección absolutamente perfecta!';
                
                // Show popup with delay for dramatic effect
                setTimeout(() => {
                    document.getElementById('winnerOverlay').classList.add('show');
                    document.getElementById('closeWinnerBtn').focus();
                }, 500);
                
                // Start all celebration effects
                this.createMassiveConfetti();
                this.createFireworks();
                this.playVictorySound();
                this.shakeScreen();
            }
            
            createMassiveConfetti() {
                const confettiCount = 200;
                const confettiPieces = [];
                
                for (let i = 0; i < confettiCount; i++) {
                    confettiPieces.push({
                        x: Math.random() * this.confettiCtx.canvas.width,
                        y: -20,
                        width: Math.random() * 10 + 5,
                        height: Math.random() * 10 + 5,
                        color: this.config.colors[Math.floor(Math.random() * this.config.colors.length)],
                        speed: Math.random() * 3 + 2,
                        rotation: Math.random() * 360,
                        rotationSpeed: Math.random() * 10 - 5
                    });
                }
                
                const animateConfetti = () => {
                    this.confettiCtx.clearRect(0, 0, this.confettiCtx.canvas.width, this.confettiCtx.canvas.height);
                    
                    confettiPieces.forEach((piece, index) => {
                        this.confettiCtx.save();
                        this.confettiCtx.translate(piece.x, piece.y);
                        this.confettiCtx.rotate(piece.rotation * Math.PI / 180);
                        
                        this.confettiCtx.fillStyle = piece.color;
                        this.confettiCtx.fillRect(-piece.width/2, -piece.height/2, piece.width, piece.height);
                        
                        this.confettiCtx.restore();
                        
                        // Update position
                        piece.y += piece.speed;
                        piece.x += Math.sin(piece.y * 0.1) * 0.5;
                        piece.rotation += piece.rotationSpeed;
                        
                        // Remove if off screen
                        if (piece.y > this.confettiCtx.canvas.height + 20) {
                            confettiPieces.splice(index, 1);
                        }
                    });
                    
                    if (confettiPieces.length > 0) {
                        requestAnimationFrame(animateConfetti);
                    }
                };
                
                animateConfetti();
            }
            
            createFireworks() {
                const fireworks = [];
                const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#feca57'];
                
                // Create 5 fireworks
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        const x = Math.random() * this.fireworksCtx.canvas.width;
                        const y = Math.random() * this.fireworksCtx.canvas.height * 0.4;
                        const particleCount = 80 + Math.floor(Math.random() * 50);
                        
                        fireworks.push({
                            x,
                            y,
                            particles: Array(particleCount).fill().map(() => ({
                                color: colors[Math.floor(Math.random() * colors.length)],
                                angle: Math.random() * Math.PI * 2,
                                speed: Math.random() * 5 + 2,
                                size: Math.random() * 3 + 1,
                                alpha: 1
                            }))
                        });
                    }, i * 600);
                }
                
                const animateFireworks = () => {
                    this.fireworksCtx.clearRect(0, 0, this.fireworksCtx.canvas.width, this.fireworksCtx.canvas.height);
                    
                    fireworks.forEach((firework, fIndex) => {
                        firework.particles.forEach((particle, pIndex) => {
                            // Update particle position
                            particle.speed *= 0.96;
                            const moveX = Math.cos(particle.angle) * particle.speed;
                            const moveY = Math.sin(particle.angle) * particle.speed;
                            
                            // Update particle alpha
                            particle.alpha -= 0.01;
                            
                            // Draw particle
                            this.fireworksCtx.globalAlpha = particle.alpha;
                            this.fireworksCtx.fillStyle = particle.color;
                            this.fireworksCtx.beginPath();
                            this.fireworksCtx.arc(
                                firework.x + moveX, 
                                firework.y + moveY, 
                                particle.size, 
                                0, 
                                Math.PI * 2
                            );
                            this.fireworksCtx.fill();
                            
                            // Remove dead particles
                            if (particle.alpha <= 0 || particle.speed < 0.1) {
                                firework.particles.splice(pIndex, 1);
                            }
                        });
                        
                        // Remove dead fireworks
                        if (firework.particles.length === 0) {
                            fireworks.splice(fIndex, 1);
                        }
                    });
                    
                    this.fireworksCtx.globalAlpha = 1;
                    
                    if (fireworks.length > 0) {
                        requestAnimationFrame(animateFireworks);
                    }
                };
                
                animateFireworks();
            }
            
            playVictorySound() {
                // Create victory sound effect using Web Audio API
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    
                    // Play victory chord
                    const frequencies = [523.25, 659.25, 783.99]; // C-E-G major chord
                    frequencies.forEach((freq, index) => {
                        setTimeout(() => {
                            const oscillator = audioContext.createOscillator();
                            const gainNode = audioContext.createGain();
                            
                            oscillator.connect(gainNode);
                            gainNode.connect(audioContext.destination);
                            
                            oscillator.frequency.value = freq;
                            oscillator.type = 'sine';
                            
                            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
                            
                            oscillator.start(audioContext.currentTime);
                            oscillator.stop(audioContext.currentTime + 1);
                        }, index * 100);
                    });
                } catch (error) {
                    console.log('Audio not available:', error);
                }
            }
            
            shakeScreen() {
                document.body.style.animation = 'screen-shake 0.5s ease-in-out';
                setTimeout(() => {
                    document.body.style.animation = '';
                }, 500);
                
                // Add screen shake keyframes
                if (!document.querySelector('#shake-styles')) {
                    const style = document.createElement('style');
                    style.id = 'shake-styles';
                    style.textContent = `
                        @keyframes screen-shake {
                            0%, 100% { transform: translateX(0); }
                            10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }
                            20%, 40%, 60%, 80% { transform: translateX(2px); }
                        }
                    `;
                    document.head.appendChild(style);
                }
            }
            
            closeWinnerPopup() {
                document.getElementById('winnerOverlay').classList.remove('show');
                
                // Clear canvases
                this.confettiCtx.clearRect(0, 0, this.confettiCtx.canvas.width, this.confettiCtx.canvas.height);
                this.fireworksCtx.clearRect(0, 0, this.fireworksCtx.canvas.width, this.fireworksCtx.canvas.height);
            }
            
            spinAgain() {
                this.closeWinnerPopup();
                setTimeout(() => {
                    if (!this.state.isSpinning) {
                        this.spinRoulette();
                    }
                }, 500);
            }
            
            handleKeyboardNavigation(event) {
                // ESC to close popup
                if (event.key === 'Escape') {
                    const overlay = document.getElementById('winnerOverlay');
                    if (overlay && overlay.classList.contains('show')) {
                        this.closeWinnerPopup();
                    }
                }
                
                // Space bar to spin (when focused on spin button)
                if (event.key === ' ' && event.target.id === 'spinButton') {
                    event.preventDefault();
                    this.spinRoulette();
                }
                
                // Enter to add food (when focused on input)
                if (event.key === 'Enter' && event.target.id === 'foodInput') {
                    event.preventDefault();
                    this.addFood();
                }
            }
            
            hideResult() {
                document.getElementById('resultContainer').classList.remove('show');
                document.getElementById('recipePreview').classList.remove('show');
            }
            
            async generateRecommendations(selectedFood) {
                const loadingContainer = document.getElementById('loadingContainer');
                const grid = document.getElementById('recommendationsGrid');
                
                // Show loading
                loadingContainer.classList.add('show');
                grid.style.display = 'none';
                
                // Simulate AI processing
                await this.delay(2000);
                
                const recommendations = this.getSmartRecommendations(selectedFood);
                
                grid.innerHTML = '';
                recommendations.forEach((rec, index) => {
                    const card = document.createElement('div');
                    card.className = 'recommendation-card animate-fade-in-up';
                    card.style.animationDelay = `${index * 0.2}s`;
                    
                    card.innerHTML = `
                        <h3>
                            <span>${rec.emoji}</span>
                            ${rec.name}
                        </h3>
                        <p>${rec.description}</p>
                        <div class="stats">
                            <div class="stat">
                                <i class="fas fa-fire"></i>
                                ${rec.calories}
                            </div>
                            <div class="stat">
                                <i class="fas fa-clock"></i>
                                ${rec.time}
                            </div>
                            <div class="stat">
                                <i class="fas fa-chart-line"></i>
                                ${rec.difficulty}
                            </div>
                        </div>
                        <button class="btn btn-primary action-btn" onclick="app.exploreRecommendation('${rec.name}')" type="button">
                            <i class="fas fa-arrow-right"></i>
                            Explorar
                        </button>
                    `;
                    
                    grid.appendChild(card);
                });
                
                // Hide loading and show results
                loadingContainer.classList.remove('show');
                grid.style.display = 'grid';
            }
            
            getSmartRecommendations(selectedFood) {
                // AI-like recommendation system
                const baseRec = this.recommendations[selectedFood];
                const similar = this.findSimilarFoods(selectedFood);
                const trending = this.getTrendingFoods();
                
                const recommendations = [];
                
                // Add base recommendation
                if (baseRec) {
                    recommendations.push({
                        name: selectedFood,
                        emoji: baseRec.emoji,
                        description: `Perfecto: ${baseRec.description}`,
                        calories: baseRec.calories,
                        time: baseRec.time,
                        difficulty: baseRec.difficulty
                    });
                }
                
                // Add similar foods
                similar.slice(0, 2).forEach(food => {
                    const rec = this.recommendations[food] || this.generateRecommendation(food);
                    recommendations.push({
                        name: food,
                        emoji: rec.emoji || '🍽️',
                        description: `Alternativa similar: ${rec.description || 'Otra gran opción'}`,
                        calories: rec.calories || '200-400',
                        time: rec.time || '20-40 min',
                        difficulty: rec.difficulty || 'Medio'
                    });
                });
                
                return recommendations.slice(0, 3);
            }
            
            findSimilarFoods(food) {
                // Simple similarity algorithm
                const category = this.getCategoryForFood(food);
                if (category) {
                    return this.foodDatabase[category].filter(f => f !== food);
                }
                
                // Fallback to popular foods
                return ['Pasta', 'Pizza', 'Tacos', 'Sushi'].filter(f => f !== food);
            }
            
            getCategoryForFood(food) {
                for (const [category, foods] of Object.entries(this.foodDatabase)) {
                    if (foods.some(f => f.toLowerCase().includes(food.toLowerCase()) || food.toLowerCase().includes(f.toLowerCase()))) {
                        return category;
                    }
                }
                return null;
            }
            
            getTrendingFoods() {
                return ['Poke Bowl', 'Ramen', 'Acai Bowl', 'Buddha Bowl'];
            }
            
            generateRecommendation(food) {
                const emojis = ['🍽️', '🥘', '🍲', '🥗', '🍖', '🐟', '🌱'];
                return {
                    emoji: emojis[Math.floor(Math.random() * emojis.length)],
                    description: 'Una deliciosa opción para disfrutar',
                    calories: `${200 + Math.floor(Math.random() * 300)}-${300 + Math.floor(Math.random() * 300)}`,
                    time: `${10 + Math.floor(Math.random() * 40)}-${20 + Math.floor(Math.random() * 40)} min`,
                    difficulty: ['Fácil', 'Medio', 'Difícil'][Math.floor(Math.random() * 3)]
                };
            }
            
            updateSpinButton(spinning) {
                const button = document.getElementById('spinButton');
                const icon = button.querySelector('i');
                
                if (spinning) {
                    button.disabled = true;
                    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Girando...';
                } else {
                    button.disabled = false;
                    button.innerHTML = '<i class="fas fa-sync-alt"></i> ¡Girar Ruleta!';
                }
            }
            
            updateUserStats(winner = null) {
                if (winner) {
                    this.state.userStats.totalSpins++;
                    this.state.userStats.foodFrequency[winner] = (this.state.userStats.foodFrequency[winner] || 0) + 1;
                    this.state.userStats.lastUsed = new Date().toISOString();
                    
                    // Update streak
                    const today = new Date().toISOString().split('T')[0];
                    if (this.state.userStats.lastUsedDay !== today) {
                        this.state.userStats.streak = (this.state.userStats.streak || 0) + 1;
                        this.state.userStats.lastUsedDay = today;
                    }
                }
                
                this.updateStatsDisplay();
                this.saveUserStats();
            }
            
            updateStatsDisplay() {
                const stats = this.state.userStats;
                
                document.getElementById('totalSpins').textContent = stats.totalSpins;
                document.getElementById('userLevel').textContent = this.calculateUserLevel(stats.totalSpins);
                document.getElementById('streakCount').textContent = stats.streak || 0;
                
                // Find favorite food
                const frequencies = stats.foodFrequency;
                const favorite = Object.keys(frequencies).reduce((a, b) => 
                    frequencies[a] > frequencies[b] ? a : b, '🍕');
                const favoriteEmoji = this.recommendations[favorite]?.emoji || '🍽️';
                document.getElementById('favoriteFoodStat').textContent = favoriteEmoji;
            }
            
            calculateUserLevel(spins) {
                if (spins >= 100) return 5;
                if (spins >= 50) return 4;
                if (spins >= 25) return 3;
                if (spins >= 10) return 2;
                return 1;
            }
            
            loadUserStats() {
                const defaultStats = {
                    totalSpins: 0,
                    foodFrequency: {},
                    streak: 0,
                    lastUsed: null,
                    lastUsedDay: null
                };
                
                try {
                    const saved = localStorage.getItem('rouletteStats');
                    return saved ? { ...defaultStats, ...JSON.parse(saved) } : defaultStats;
                } catch {
                    return defaultStats;
                }
            }
            
            saveUserStats() {
                try {
                    localStorage.setItem('rouletteStats', JSON.stringify(this.state.userStats));
                } catch (error) {
                    console.warn('Could not save user stats:', error);
                }
            }
            
            loadPreferences() {
                try {
                    const saved = localStorage.getItem('userPreferences');
                    return saved ? JSON.parse(saved) : { darkMode: false, notifications: true };
                } catch {
                    return { darkMode: false, notifications: true };
                }
            }
            
            savePreferences() {
                try {
                    localStorage.setItem('userPreferences', JSON.stringify(this.state.preferences));
                } catch (error) {
                    console.warn('Could not save preferences:', error);
                }
            }
            
            loadFoods() {
                try {
                    const saved = localStorage.getItem('rouletteFoods');
                    return saved ? JSON.parse(saved) : ['Pizza', 'Tacos', 'Sushi', 'Hamburguesa', 'Pasta'];
                } catch {
                    return ['Pizza', 'Tacos', 'Sushi', 'Hamburguesa', 'Pasta'];
                }
            }
            
            saveFoods() {
                try {
                    localStorage.setItem('rouletteFoods', JSON.stringify(this.state.foods));
                } catch (error) {
                    console.warn('Could not save foods:', error);
                }
            }
            
            loadAchievements() {
                const defaultAchievements = {
                    'first-spin': false,
                    'five-spins': false,
                    'ten-foods': false,
                    'daily-streak': false
                };
                
                try {
                    const saved = localStorage.getItem('achievements');
                    return saved ? JSON.parse(saved) : defaultAchievements;
                } catch {
                    return defaultAchievements;
                }
            }
            
            saveAchievements() {
                try {
                    localStorage.setItem('achievements', JSON.stringify(this.state.achievements));
                } catch (error) {
                    console.warn('Could not save achievements:', error);
                }
            }
            
            checkAchievements() {
                const stats = this.state.userStats;
                const achievements = this.state.achievements;
                
                // First spin
                if (!achievements['first-spin'] && stats.totalSpins >= 1) {
                    achievements['first-spin'] = true;
                    this.showAchievement('first-spin');
                }
                
                // Five spins
                if (!achievements['five-spins'] && stats.totalSpins >= 5) {
                    achievements['five-spins'] = true;
                    this.showAchievement('five-spins');
                }
                
                // Ten foods
                if (!achievements['ten-foods'] && this.state.foods.length >= 10) {
                    achievements['ten-foods'] = true;
                    this.showAchievement('ten-foods');
                }
                
                // Daily streak
                if (!achievements['daily-streak'] && stats.streak >= 3) {
                    achievements['daily-streak'] = true;
                    this.showAchievement('daily-streak');
                }
                
                this.saveAchievements();
                this.updateAchievements();
            }
            
            showAchievement(id) {
                const card = document.querySelector(`.achievement-card[data-id="${id}"]`);
                if (card) {
                    card.classList.add('unlocked');
                    
                    // Show notification
                    const title = card.querySelector('h3').textContent;
                    this.showNotification(`¡Logro desbloqueado: ${title}!`, 'success');
                }
            }
            
            updateAchievements() {
                const achievements = document.querySelectorAll('.achievement-card');
                achievements.forEach(card => {
                    const id = card.dataset.id;
                    if (this.state.achievements[id]) {
                        card.classList.add('unlocked');
                    }
                });
            }
            
            // Event Handlers
            handleInputValidation(event) {
                const input = event.target;
                const value = input.value;
                
                // Real-time validation
                if (value.length > 20) {
                    input.setCustomValidity('Máximo 20 caracteres');
                } else if (this.state.foods.some(food => food.toLowerCase() === value.toLowerCase())) {
                    input.setCustomValidity('Esta opción ya existe');
                } else {
                    input.setCustomValidity('');
                }
            }
            
            handleResize() {
                // Responsive adjustments
                this.setupRoulette();
                this.resizeCanvas();
            }
            
            // Actions
            async shareResult() {
                const result = this.state.currentResult;
                if (!result) return;
                
                const shareData = {
                    title: 'Ruleta Gastronómica Pro',
                    text: `¡La ruleta decidió que coma ${result}! 🎲🍽️`,
                    url: window.location.href
                };
                
                try {
                    if (navigator.share) {
                        await navigator.share(shareData);
                        this.trackEvent('share_result', { method: 'native', food: result });
                    } else {
                        await navigator.clipboard.writeText(`${shareData.text} ${shareData.url}`);
                        this.showNotification('Enlace copiado al portapapeles', 'success');
                        this.trackEvent('share_result', { method: 'clipboard', food: result });
                    }
                } catch (error) {
                    console.warn('Share failed:', error);
                    this.showNotification('Error al compartir', 'error');
                }
            }
            
            exploreRecommendation(foodName) {
                // Simulate exploring a recommendation
                this.showNotification(`Explorando "${foodName}"...`, 'info');
                this.trackEvent('explore_recommendation', { food: foodName });
                
                // Could integrate with recipe APIs, restaurant locators, etc.
                setTimeout(() => {
                    this.showNotification('¡Funcionalidad en desarrollo!', 'info');
                }, 1000);
            }
            
            showRecipe() {
                const result = this.state.currentResult;
                if (!result) return;
                
                const recipe = this.recipeDatabase[result];
                if (!recipe) {
                    this.showNotification('No hay receta disponible para esta opción', 'warning');
                    return;
                }
                
                document.getElementById('recipeTitle').textContent = recipe.title;
                document.getElementById('recipeCuisine').textContent = `Cocina: ${recipe.cuisine}`;
                document.getElementById('recipeDifficulty').textContent = `Dificultad: ${recipe.difficulty}`;
                document.getElementById('recipeTime').textContent = recipe.time;
                document.getElementById('recipeServings').textContent = recipe.servings;
                document.getElementById('recipeCalories').textContent = recipe.calories;
                
                const recipeImage = document.getElementById('recipeImage');
                recipeImage.style.backgroundImage = `url('${recipe.image}')`;
                
                const ingredientsList = document.getElementById('recipeIngredients');
                ingredientsList.innerHTML = '';
                recipe.ingredients.forEach(ingredient => {
                    const li = document.createElement('li');
                    li.textContent = ingredient;
                    ingredientsList.appendChild(li);
                });
                
                const instructionsList = document.getElementById('recipeInstructions');
                instructionsList.innerHTML = '';
                recipe.instructions.forEach(instruction => {
                    const li = document.createElement('li');
                    li.textContent = instruction;
                    instructionsList.appendChild(li);
                });
                
                document.getElementById('recipePreview').classList.add('show');
                
                // Scroll to recipe
                document.getElementById('recipePreview').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start'
                });
            }
            
            // Cookie Management
            showCookieBanner() {
                if (!this.state.cookiesAccepted && !localStorage.getItem('cookiesRejected')) {
                    setTimeout(() => {
                        document.getElementById('cookieBanner').classList.add('show');
                    }, 3000);
                }
            }
            
            acceptCookies() {
                this.state.cookiesAccepted = true;
                localStorage.setItem('cookiesAccepted', 'true');
                document.getElementById('cookieBanner').classList.remove('show');
                this.initializeTracking();
                this.showNotification('Cookies aceptadas', 'success');
            }
            
            rejectCookies() {
                localStorage.setItem('cookiesRejected', 'true');
                document.getElementById('cookieBanner').classList.remove('show');
                this.showNotification('Cookies rechazadas', 'info');
            }
            
            // Drag and Drop
            setupDragAndDrop() {
                const optionsGrid = document.getElementById('optionsGrid');
                
                optionsGrid.addEventListener('dragstart', (e) => {
                    if (e.target.classList.contains('option-card')) {
                        e.dataTransfer.setData('text/plain', e.target.dataset.index);
                        e.target.classList.add('dragging');
                    }
                });
                
                optionsGrid.addEventListener('dragend', (e) => {
                    if (e.target.classList.contains('option-card')) {
                        e.target.classList.remove('dragging');
                    }
                });
                
                optionsGrid.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    const card = e.target.closest('.option-card');
                    if (card) {
                        card.classList.add('drag-over');
                    }
                });
                
                optionsGrid.addEventListener('dragleave', (e) => {
                    const card = e.target.closest('.option-card');
                    if (card) {
                        card.classList.remove('drag-over');
                    }
                });
                
                optionsGrid.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const fromIndex = parseInt(e.dataTransfer.getData('text/plain'));
                    const toCard = e.target.closest('.option-card');
                    
                    if (toCard) {
                        const toIndex = parseInt(toCard.dataset.index);
                        this.moveFood(fromIndex, toIndex);
                    }
                    
                    // Remove drag-over class
                    document.querySelectorAll('.option-card.drag-over').forEach(card => {
                        card.classList.remove('drag-over');
                    });
                });
            }
            
            moveFood(fromIndex, toIndex) {
                if (fromIndex === toIndex) return;
                
                const food = this.state.foods[fromIndex];
                this.state.foods.splice(fromIndex, 1);
                this.state.foods.splice(toIndex, 0, food);
                
                this.updateDisplay();
                this.saveFoods();
                this.showNotification('Opción movida', 'info');
            }
            
            // Analytics and Tracking
            initializeTracking() {
                if (this.state.cookiesAccepted && typeof gtag !== 'undefined') {
                    gtag('config', 'GA_MEASUREMENT_ID', {
                        page_title: 'Ruleta Gastronómica Pro',
                        page_location: window.location.href
                    });
                }
            }
            
            trackPageView() {
                if (this.state.cookiesAccepted && typeof gtag !== 'undefined') {
                    gtag('event', 'page_view', {
                        page_title: 'Ruleta Gastronómica Pro',
                        page_location: window.location.href
                    });
                }
            }
            
            trackEvent(action, parameters = {}) {
                if (this.state.cookiesAccepted && typeof gtag !== 'undefined') {
                    gtag('event', action, {
                        event_category: 'Food Roulette',
                        event_label: action,
                        ...parameters
                    });
                }
                
                // Console logging for development
                console.log('Event:', action, parameters);
            }
            
            // Notifications
            showNotification(message, type = 'info') {
                // Create notification element
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                notification.style.cssText = `
                    position: fixed;
                    top: 120px;
                    right: 20px;
                    background: ${type === 'error' ? '#ef4444' : type === 'warning' ? '#f59e0b' : type === 'success' ? '#10b981' : '#3b82f6'};
                    color: white;
                    padding: 16px 24px;
                    border-radius: 12px;
                    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
                    z-index: 10000;
                    transform: translateX(100%);
                    transition: transform 0.3s ease;
                    max-width: 300px;
                    font-weight: 500;
                `;
                
                const icon = type === 'error' ? '❌' : type === 'warning' ? '⚠️' : type === 'success' ? '✅' : 'ℹ️';
                notification.innerHTML = `${icon} ${message}`;
                
                document.body.appendChild(notification);
                
                // Animate in
                setTimeout(() => {
                    notification.style.transform = 'translateX(0)';
                }, 100);
                
                // Auto remove
                setTimeout(() => {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }
            
            // Utilities
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
            
            shuffleArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            }
            
            // Initial recommendations
            loadInitialRecommendations() {
                const grid = document.getElementById('recommendationsGrid');
                const defaultRecommendations = [
                    {
                        name: 'Pizza Margherita',
                        emoji: '🍕',
                        description: 'Clásica italiana con tomate, mozzarella y albahaca fresca',
                        calories: '250-350',
                        time: '15-20 min',
                        difficulty: 'Fácil'
                    },
                    {
                        name: 'Tacos al Pastor',
                        emoji: '🌮',
                        description: 'Auténticos tacos mexicanos con piña y cilantro',
                        calories: '200-300',
                        time: '25-30 min',
                        difficulty: 'Medio'
                    },
                    {
                        name: 'Bowl de Quinoa',
                        emoji: '🥗',
                        description: 'Opción saludable con vegetales frescos y aguacate',
                        calories: '300-400',
                        time: '20-25 min',
                        difficulty: 'Fácil'
                    }
                ];
                
                defaultRecommendations.forEach((rec, index) => {
                    const card = document.createElement('div');
                    card.className = 'recommendation-card animate-fade-in-up';
                    card.style.animationDelay = `${index * 0.2}s`;
                    
                    card.innerHTML = `
                        <h3>
                            <span>${rec.emoji}</span>
                            ${rec.name}
                        </h3>
                        <p>${rec.description}</p>
                        <div class="stats">
                            <div class="stat">
                                <i class="fas fa-fire"></i>
                                ${rec.calories}
                            </div>
                            <div class="stat">
                                <i class="fas fa-clock"></i>
                                ${rec.time}
                            </div>
                            <div class="stat">
                                <i class="fas fa-chart-line"></i>
                                ${rec.difficulty}
                            </div>
                        </div>
                        <button class="btn btn-primary action-btn" onclick="app.exploreRecommendation('${rec.name}')" type="button">
                            <i class="fas fa-arrow-right"></i>
                            Explorar
                        </button>
                    `;
                    
                    grid.appendChild(card);
                });
            }
        }
        
        // Initialize application when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎲 Iniciando Ruleta Gastronómica Pro...');
            
            try {
                window.app = new FoodRouletteApp();
                console.log('✅ Aplicación iniciada correctamente');
            } catch (error) {
                console.error('❌ Error al inicializar:', error);
                
                // Intentar nuevamente después de un delay
                setTimeout(() => {
                    try {
                        window.app = new FoodRouletteApp();
                        console.log('✅ Aplicación iniciada en segundo intento');
                    } catch (secondError) {
                        console.error('❌ Error en segundo intento:', secondError);
                    }
                }, 1000);
            }
        });
        
        // Global error handling
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
            if (window.app && typeof window.app.showNotification === 'function') {
                window.app.showNotification('Se produjo un error inesperado', 'error');
            }
        });
        
        // Performance monitoring
        if ('performance' in window) {
            window.addEventListener('load', () => {
                const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
                console.log(`⚡ Tiempo de carga: ${loadTime}ms`);
            });
        }
    </script>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        
        // Will be configured when cookies are accepted
    </script>
    
    <!-- Schema.org JSON-LD for enhanced SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "Ruleta Gastronómica Pro",
        "operatingSystem": "Web Browser",
        "applicationCategory": "Food & Dining",
        "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "4.8",
            "ratingCount": "1247"
        },
        "offers": {
            "@type": "Offer",
            "price": "0.00",
            "priceCurrency": "USD"
        }
    }
    </script>
</body>
</html>
